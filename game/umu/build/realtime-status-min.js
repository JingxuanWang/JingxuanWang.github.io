function shuffle(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}function ajax(a,b,c){var d=new XMLHttpRequest;d.overrideMimeType&&d.overrideMimeType("application/json"),d.open("GET",a,!0),d.ontimeout=c,d.onreadystatechange=function(){4===d.readyState&&(200===d.status||0===d.status&&d.responseText?b(d.responseText):c())},d.send(null)}var UILabel=me.Renderable.extend({init:function(a,b,c){this.settings=c||{},this._super(me.Renderable,"init",[a,b,10,10]),1==this.settings.bitmapFont?(this.font=new me.BitmapFont(this.settings.font||"32x32_font",this.settings.size||32,this.settings.scale||null,this.settings.firstChar||null),this.font.set(this.settings.textAlign||"left")):this.font=new me.Font(this.settings.font||"Arial",this.settings.size||32,this.settings.fillStyle||"black",this.settings.textAlign||"left"),this.floating=!0,this.text=this.settings.text||"NEW LABEL"},draw:function(a){if(1==this.settings.bitmapFont)this.font.draw(a,this.text,this.pos.x,this.pos.y);else{var b=a.getContext();this.font.measureText(b,this.text),this.font.draw(b,this.text,this.pos.x,this.pos.y)}}}),Avatar=me.Container.extend({init:function(a,b,c){this.speedNormal=100,this.speedMax=50,this.speedMin=200,this.labelOffsetX=50,this.labelOffsetY=50,this._super(me.Container,"init"),this.animSprite=new me.AnimationSheet(a,b,{image:me.loader.getImage("caonima"),spritewidth:240,spriteheight:320}),this.userData=c,this.animSprite.addAnimation("walk",[0,1,2,3,4],this.speedNormal),this.animSprite.setCurrentAnimation("walk"),this.animSprite.setAnimationFrame(Math.floor(4*Math.random())),this.label=new UILabel(a+this.labelOffsetX,b+this.labelOffsetY,{bitmapFont:!0,text:this.userData.user_id+" : "+this.userData.score}),this.addChild(this.animSprite,1),this.addChild(this.label,2)},update:function(a){return this.label.pos.x=this.animSprite.pos.x+this.labelOffsetX,this.label.pos.y=this.animSprite.pos.y+this.labelOffsetY,this.label.text=this.userData.user_id+"\n"+this.userData.score,this._super(me.Container,"update",[a])},speedUp:function(a,b){this.animSprite.current.animationspeed=this.speedMax,this.moveToTop(),this.animSprite.scaleFlag=!0;new me.Tween(this.animSprite.scale).to({x:1.5,y:1.5},200).easing(me.Tween.Easing.Linear.None).start();this.moveEffect(a,b)},speedDown:function(a,b){this.animSprite.current.animationspeed=this.speedMin,this.moveEffect(a,b)},moveEffect:function(a,b){{var c=this;new me.Tween(this.animSprite.pos).to({x:a,y:b},2e3).easing(me.Tween.Easing.Linear.None).onComplete(function(){c.animSprite.current.animationspeed=c.speedNormal,c.animSprite.scaleFlag=!0;new me.Tween(c.animSprite.scale).to({x:1,y:1},200).easing(me.Tween.Easing.Linear.None).start()}).start()}}}),game={resources:[{name:"logo",type:"image",src:"data/img/Logo.png"},{name:"32x32_font",type:"image",src:"data/img/32x32_font.png"},{name:"caonima",type:"image",src:"data/img/Caonima.png"}],data:{screenWidth:1280,screenHeight:960},onload:function(){return me.video.init("screen",me.video.CANVAS,game.data.screenWidth,game.data.screenHeight,!0,"auto")?(me.state.set(me.state.LOADING,new game.LoadingScene),me.state.set(me.state.PLAY,new game.PlayScene),void me.loader.load({name:"logo",type:"image",src:"data/img/Logo.png"},this.onLogoLoaded.bind(this))):void alert("Your browser does not support HTML5 canvas.")},onLogoLoaded:function(){me.loader.preload(game.resources),me.loader.onload=this.loaded,me.state.change(me.state.LOADING)},loaded:function(){me.state.change(me.state.PLAY)}};game.PlayScene=me.ScreenObject.extend({onResetEvent:function(){this.background=new me.ColorLayer("background","#FFFFFF",0),me.game.world.addChild(this.background,0),this.avatars={},this.userData={};for(var a=0;5>a;a++){var b=new Avatar(game.data.screenWidth-50,Math.random()*(game.data.screenHeight-200)-100,{user_id:"ID: "+a,score:0});this.avatars[b.userData.user_id]=b,me.game.world.addChild(b,100-a)}me.timer.setInterval(this.updateData.bind(this),3e3,!1)},updateData:function(){console.log("UpdateData Called");var a=null,b=null;for(var c in this.avatars){var d=this.avatars[c],e=Math.floor(3e3*Math.random());e>d.userData.score&&(d.userData.score=e),(null==a||d.userData.score>a)&&(a=d.userData.score),(null==b||d.userData.score<b)&&(b=d.userData.score)}for(var c in this.avatars){var d=this.avatars[c],f=(d.userData.score-b)/(a-b),g=800-700*f;g<d.animSprite.pos.x?(me.game.world.moveToTop(d),d.speedUp(g,d.animSprite.pos.y)):d.speedDown(g,d.animSprite.pos.y)}},_onDataFetched:function(a){console.log(a)},onDestroyEvent:function(){}}),game.LoadingScene=me.ScreenObject.extend({onResetEvent:function(){me.game.reset(),me.game.world.addChild(new me.ColorLayer("background","#FFFFFF",0));var a=new ProgressBar(new me.Vector2d,game.data.screenWidth,20);this.handle=me.event.subscribe(me.event.LOADER_PROGRESS,a.onProgressUpdate.bind(a)),me.game.world.addChild(a,1);var b=new me.Sprite(game.data.screenWidth/2-336,game.data.screenHeight/2-177,me.loader.getImage("logo"),672,354);me.game.world.addChild(b,1)},onDestroyEvent:function(){this.handle&&(me.event.unsubscribe(this.handle),this.handle=null)}});var ProgressBar=me.Renderable.extend({init:function(a,b,c){me.Renderable.prototype.init.apply(this,[a.x,a.y,b,c]),this.invalidate=!1,this.barHeight=40,this.progress=0},onProgressUpdate:function(a){this.progress=Math.floor(a*this.width),this.invalidate=!0},update:function(){return this.invalidate===!0?(this.invalidate=!1,!0):!1},draw:function(a){var b=a.getContext();b.fillStyle="black",b.fillRect(0,this.height/2-this.barHeight/2,this.width,this.barHeight),b.fillStyle="#55aa00",b.fillRect(2,this.height/2-this.barHeight/2,this.progress,this.barHeight)}});